---
title: 'OncoSimulR: Simulating pathways and mutual exclusivity.'
author: "Blanca Lacruz Pleguezuelos, Víctor Mateo Cáceres, Manuel Moradiellos Corpus"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: yes
    df_print: paged
  bookdown::html_document2:
    css: custom4.css
    toc: yes
    toc_float: yes
    fig_retina: null
    fig_caption: yes
classoption: a4paper
geometry: margin=3cm
fontsize: 12pt
bibliography: trabajo_oncosimul.bib
biblio-style: apalike
link-citations: yes
vignette: |
  %\VignetteIndexEntry{OncoSimulR: Simulating pathways and mutual exclusivity.} %\VignetteEngine{knitr::rmarkdown}  %\VignettePackage{OncoSimulR}  %\VignetteEncoding{UTF-8}  %\VignetteDepends{OncoSimulR}
---

```{r setup, include = FALSE}
time0 <- Sys.time()
knitr::opts_chunk$set(echo = TRUE, collapse = FALSE)
options(width = 70)
require(BiocStyle)
require(pander)
require(OncoSimulR)
require(ggplot2)
require(reshape2)
```

# Glioblastoma multiforme models

## Models from @cristea17

@cristea17 also showcased pathTiMEx's performance using a large gliobastoma 
dataset from The Cancer Genome Atlas Program (TCGA) (@cerami12); we will
map the DAG coming from the left-hand side of Figure 3C (\@ref(fig:path3c)).
Our purpose here is to show that tumor progression in glioblastoma multiforme
seems much more complex: all the nodes are modules with mutual exclusivity,
which suggests variability in this process is larger. 

Furthermore, a closer look at the figure will reveal this algorithm found different
modules where a certain gene is repeated (this happens with TP53 in the figure).
The authors solved this issue by differentiating the type of mutation that happens
in each case, but having modules with overlapping genes can be a problem, as
we will see in the next section.

```{r path3c, echo=FALSE, out.width="90%", out.height="90%",fig.cap= "\\label{fig:tomate}. Detail of left-hand size of Figure 3C from @cristea17."}
knitr::include_graphics("figures/path_figure3c.png")
```

This DAG has the same issues as the previous one, and therefore we could think
of the three same strategies to represent it: a "naïve" one where the nodes with
unknown dependencies branch directly from the root node, a more accurate version
implementing order effects, or a model where we go one step further to see what
would happen if more restrictions were implemented. 

In this case, we will only show the three DAGs of dependencies, just to exhibit the
high complexity of tumor progression in this case, and then we will move on to
a slightly different model.

### 1st approach: modules branching from the root node

```{r path_fig3c_root}
gb_drv <- c("CDKN2A", "CDK4", "TP53-M", "MDM4", "MDM2", 
            "NF1", "FAF1", "SPTA1", "OBSCN", "CNTNAP2", 
            "PTEN-M", "PTEN-D", "PIK3CA", "IDH1",
            "PDGFRA", "LRP2", "EGFR", "RB1", "TP53-D", "PAOX")

# All nodes with unknown prerequisites/previous mutations will
# be modeled as if they branch from Root
TCGA_gb_root <- allFitnessEffects(data.frame(
                  parent = c("Root", "A", "Root", "Root", "B", "C", "D", "Root"),
                  child = c("A", "B", "C", "D", "E", "E", "E", "F"),
                  s = 0.2,
                  sh = -0.9,
                  typeDep = "MN"),
                  geneToModule = c("Root" = "Root",
                                   "A" = "CDKN2A, CDK4",
                                   "B" = "TP53-M, MDM4, MDM2",
                                   "C" = "NF1, FAF1, SPTA1, OBSCN, CNTNAP2",
                                   "D" = "PTEN-M, PTEN-D, PIK3CA, IDH1",
                                   "E" = "PDGFRA, LRP2",
                                   "F" = "EGFR, RB1, TP53-D, PAOX"),
                  drvNames = gb_drv)

plot(TCGA_gb_root, expandModules = TRUE, autofit = TRUE)
```

### Model with order effects

```{r path_fig3c_order}
TCGA_gb_order <- allFitnessEffects(data.frame(
        parent = c("Root", "A", "B", "C", "D"),
        child = c("A", "B", rep("E", 3)),
        s = 0.2,
        sh = -0.9,
        typeDep = "MN"),
        geneToModule = c("Root" = "Root",
                         "A" = "CDKN2A, CDK4",
                         "B" = "TP53-M, MDM4, MDM2",
                         "C" = "NF1, FAF1, SPTA1, OBSCN, CNTNAP2",
                         "D" = "PTEN-M, PTEN-D, PIK3CA, IDH1",
                         "E" = "PDGFRA, LRP2",
                         "F" = "EGFR, RB1, TP53-D, PAOX"),
        orderEffects = c("A > C" = 0.02,
                         "A > D" = 0.02,
                         "B > F" = 0.02,
                         "C > F" = 0.02,
                         "D > F" = 0.02)
        )

plot(TCGA_gb_order, expandModules = TRUE, autofit = TRUE)
```

### Implementing new dependencies

```{r path_fig3c_dependencies}
TCGA_gb_dep <- allFitnessEffects(data.frame(
                    parent = c("Root", rep("A", 3), rep(c("B", "C", "D"), 2)),
                    child = c("A", "B", "C", "D", rep("E", 3), rep("F", 3)),
                    s = 0.2,
                    sh = -0.9,
                    typeDep = "MN"),
                    geneToModule = c("Root" = "Root",
                                     "A" = "CDKN2A, CDK4",
                                     "B" = "TP53-M, MDM4, MDM2",
                                     "C" = "NF1, FAF1, SPTA1, OBSCN, CNTNAP2",
                                     "D" = "PTEN-M, PTEN-D, PIK3CA, IDH1",
                                     "E" = "PDGFRA, LRP2",
                                     "F" = "EGFR, RB1, TP53-D, PAOX"))
plot(TCGA_gb_dep, expandModules = TRUE, autofit = TRUE)
```

